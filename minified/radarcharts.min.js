/* radarcharts - Canvas charts with radar impression
 * @author kikoshoung
 * last modified at 2013-03-21 11:40:13
 */
var Radarcharts=function(t){this.options=t,this.init()};Radarcharts.prototype={firstTime:!0,freq:40,config:{maxValue:100,padding:.2,bg:{colors:["#404040","#5f5f5f"],num:5,type:0},border:{width:2,color:"#adfc58"},title:{font:"bold 12px arial",color:"black"},size:{s:[200,200],m:[300,300],l:[400,400]},duration:200},clone:function(t){return JSON.parse(JSON.stringify(t))},init:function(){var t=this.bgCan=$("<canvas>\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301Canvas\u3002</canvas>"),e=this.bdrCan=$("<canvas>\u62b1\u6b49\uff0c\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301Canvas\u3002</canvas>");this.extConfig={},$.extend(this.extConfig,this.config,this.options.config),this.bgCtx=t[0].getContext("2d"),this.bdrCtx=e[0].getContext("2d"),this.renderCanvas(),this.drawBg(),this.drawBdr()},renderCanvas:function(){var t=this.bgCan,e=this.bdrCan,i=this.extConfig,r=this.options,s=$("<div></div>"),n=this.options.renderTo,a=this.width=i.size[r.size][0],o=this.height=i.size[r.size][1];s.css({position:"relative",width:a,height:o}),t.css({position:"absolute",zIndex:10}).attr({width:a,height:o}),e.css({position:"absolute",zIndex:11}).attr({width:a,height:o}),this.centerPoint=[a/2,o/2],n.append(s),s.append(t),s.append(e)},drawBg:function(){for(var t=this.bgCtx,e=this.extConfig,i=e.bg,r=this.radius=this.width*(1-e.padding)/2,s=r/i.num,n=0;i.num>n;n++){var r=this.radius,a=this.getVertices(r-n*s),o=this.options.items;0==n&&(this.maxVertices=a),t.beginPath(),t.moveTo(a[0][0],a[0][1]);for(var h=0;a.length>h;h++){var l=h+1;if(l==a.length&&(l=0),t.lineTo(a[l][0],a[l][1]),t.strokeStyle="transparent",n==i.num-1){var c,f=this.maxVertices[h][0],g=this.maxVertices[h][1],d=this.centerPoint,v="middle";f>d[0]-1&&d[0]+1>f?(c="center",v=g>d[0]?"top":"bottom"):f>d[0]?c="left":d[0]>f&&(c="right"),t.textAlign=c,t.textBaseline=v,t.font=e.title.font,t.fillStyle=e.title.color,t.fillText(o[h].name,f,g)}}t.fillStyle=i.colors[n%i.colors.length],i.type?(t.strokeStyle=i.colors[0],t.stroke()):t.fill(),t.closePath()}},drawBdr:function(t){this.timer&&clearInterval(this.timer),this.firstTime=t?!1:!0,this.firstTime&&clearInterval(this.timer);var e=t?t:this.options.items,i=this.initItems=this.getInitItems(),r=this.getItemVertices(e),s=this.getSteps(i,e),n=this.extConfig,a=this;this.timer=setInterval(function(){var t=a.bdrCtx;if(--a.frames,a.frames>=0){t.clearRect(0,0,a.width,a.height),t.beginPath();for(var e=0;i.length>e;e++)i[e].value=i[e].value+s[e];r=a.getItemVertices(i),t.moveTo(r[0][0],r[0][1]);for(var e=0;r.length>e;e++){var o=e+1;o==r.length&&(o=0),t.lineTo(r[o][0],r[o][1]),t.strokeStyle=n.border.color,t.lineWidth=n.border.width,t.stroke()}t.closePath()}else clearInterval(a.timer)},a.freq)},drawBdrFrame:function(t){var e=this;e.firstTime=t?!1:!0,e.timer&&clearInterval(e.timer);var i=t?t:e.options.items,r=e.initItems=e.getInitItems(),s=e.getItemVertices(i),n=e.getSteps(r,i);ctx=e.bdrCtx,config=this.extConfig,e.timer=setInterval(function(){if(--e.frames,e.frames>=0){ctx.clearRect(0,0,e.width,e.height),ctx.beginPath();for(var t=0;r.length>t;t++)r[t].value=r[t].value+n[t];s=e.getItemVertices(r),ctx.moveTo(s[0][0],s[0][1]);for(var t=0;s.length>t;t++){var i=t+1;i==s.length&&(i=0),ctx.lineTo(s[i][0],s[i][1]),ctx.strokeStyle=config.border.color,ctx.stroke()}ctx.closePath()}else clearInterval(e.timer)},e.freq)},getVertices:function(t){for(var e=this.options.items,i=e.length,r=this.centerPoint,s=[],n=0;i>n;n++){var a=n*(360/i)+180,o=Math.sin(Math.PI*a/180)*t+r[0],h=Math.cos(Math.PI*a/180)*t+r[1];s.push([o,h])}return s},getInitItems:function(){var t=this.options.items.length,e=[];if(this.firstTime)for(var i=0;t>i;i++)e.push({value:0});else e=this.clone(this.initItems);return e},getItemVertices:function(t){for(var e=this.maxVertices,i=[],r=0;e.length>r;r++){var s=t[r].value/this.extConfig.maxValue,n=this.centerPoint,a=(this.ctx,this.radius),o=r*(360/e.length)+180,h=Math.sin(Math.PI*o/180)*a*s+n[0],l=Math.cos(Math.PI*o/180)*a*s+n[1];i.push([h,l])}return i},getSteps:function(t,e){var i=[];len=t.length,duration=this.extConfig.duration,freq=this.freq,frames=this.frames=Math.ceil(duration/freq);for(var r=0;len>r;r++){var s=(e[r].value-t[r].value)/frames;i.push(s)}return i}};