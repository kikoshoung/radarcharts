/* radarcharts - Canvas charts with radar impression
 * @author kikoshoung
 * last modified at 2013-04-02 12:06:51
 */
(function(){var e=20,t=[.4,.8,1],r="Sorry, canvas is not supported in your browser.",n=1,o={style:{font:"normal 12px Arial",color:"red"},size:["100%","100%"],title:{text:"Radar chart title",width:"60%",font:"normal 20px Arial",color:"black",padding:"10px 10px",margin:"0 20%",textAlign:"center",border:"1px solid #a5a5a5",borderRadius:"5px"},legend:{color:"black",border:"1px solid #a5a5a5",borderRadius:"5px",margin:"0 20%",padding:0},paddingPercentage:.2,background:{type:"polygon",colors:["#e5e5e5"],border:{width:"1px",color:"#a5a5a5"},num:1},axis:{width:"1px",color:"#a5a5a5"},marker:{radius:"4px",border:{width:"2px",color:"white"}},header:{color:"black",offset:"5px"},duration:300,ploter:{width:"2px",colors:["#289af3","#E4780B","#71bbf5","#FDA30D","#134973","#E4390B","#365873","#FD1C0D","#207ac0","#FC8A4B","#1953dc","#7B2C00","#1d24fa","#7B4425","#19badc","#C84700","#1dfae5","#fb5900"]},tooltip:{width:"100px",border:"2px solid transparent",borderRadius:"5px",format:"<b>{series.name}</b><br/>{point.name}: {point.value}"}},a=function(e,t,r){var i=document.createElement(e);if(t)for(var n in t)i.setAttribute(n,t[n]);return r&&(i.innerHTML=r),i},s=function(e){if("object"!=typeof e||e.nodeType)return e;var t=e.constructor===Array?[]:{};for(var r in e)t[r]=arguments.callee(e[r]);return t},l=function(e,t){var r=s(t);for(var i in e)r[i]=r[i]instanceof Object&&e[i]?r[i]instanceof Array?s(e[i]):arguments.callee(e[i],r[i]):e[i];return r},d=function(e,t,r){for(var i=[],n=t.centerPoint,o=t.dataLength,r=(e.paddingPercentage,r?r:0),a=e.size,s=0;o>s;s++){var l=s*(360/o),d="object"==typeof r?r[s]:r,h=c(l)*d+n[0],p=f(l)*d+n[1];i.push([h,a[1]-p])}return i},h=function(e,t,r){var i,n,o=[],a=e.series[r],s=t.dataLength,l=e.preSeries,d=e.paddingPercentage,h=(e.size,t.centerPoint),p=(t.frameNum,(h[0]<h[1]?h[0]:h[1])/e.maxValue);l=l?l[r]:{name:a.name,data:v(a,t)};for(var u=0;s>u;u++){var g=u*(360/s),m=(a.data[u]-l.data[u])/t.frameNum*p;i=c(g)*m*(1-d),n=f(g)*m*(1-d),o.push([i,-n])}return o},p=function(e,t){return(e[0]<e[1]?e[0]:e[1])*(1-t)},c=function(e){return Math.sin(Math.PI*e/180)},f=function(e){return Math.cos(Math.PI*e/180)},u=function(e){for(var t=e.length,r=e[0].data.length,i=0;t>i;i++)for(var n=0;r>n;n++)e[i].data[n]=parseFloat(e[i].data[n])},g=function(e,t){return"string"==typeof e?"%"===e.charAt(e.length-1)?parseFloat(e)/100*t:parseFloat(e):e},m=function(e,t,r){if(!e.preSeries)return 0;for(var i=e.preSeries[r],n=t.dataLength,o=t.centerPoint,a=[],s=(o[0]<o[1]?o[0]:o[1])/e.maxValue*(1-e.paddingPercentage),l=0;n>l;l++)a.push(i.data[l]*s);return a},v=function(e,t){for(var r=[],i=t.dataLength,n=0;i>n;n++)r.push(0);return r},b=function(e){var t,r=[e.offsetLeft,e.offsetTop],i=e.offsetParent;return i&&(t=b(i),r[0]+=t[0],r[1]+=t[1]),r},x=function(e){var t={width:"width",height:"height",color:"color",font:"font",border:"border",padding:"padding",margin:"margin",borderRadius:"border-radius",textAlign:"text-align"},r="";for(var i in e)t[i]&&(r+=t[i]+": "+e[i]+";");return r},y=function(e,t){return e.className.match(RegExp("(\\s|^)"+t+"(\\s|$)"))},w=function(e,t){y(e,t)||(e.className+=" "+t)},k=function(e,t){if(y(e,t)){var r=RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ")}},T=function(e,t,r){var i=Math.round(e[0]),n=Math.round(e[1]),o=t[0],a=t[1],s=r.marker?parseInt(r.marker.radius)+parseInt(r.marker.border.width):5;return i+s>=o&&o>=i-s&&n+s>=a&&a>=n-s?!0:!1},L=function(e){for(var t=["categories","series","maxValue"],r=t.length,i=0;r>i;i++)if(!e[t[i]])throw'Error: Can not find param "'+t[i]+'" in options.'},P=function(){};P.prototype={init:function(){this.cacheVariable(),this.draw()},cacheVariable:function(){var t=this.options;this.size=t.size,this.elem=a("canvas",{width:this.size[0],height:this.size[1]},r),this.options.wrapper.appendChild(this.elem),this.ctx=this.elem.getContext("2d"),this.frameNum=Math.ceil(t.duration/e),this.centerPoint=[this.size[0]/2,this.size[1]/2],this.dataLength=t.series[0].data.length}};var z=function(e){this.options=e,this.init()};z.prototype=new P,z.prototype.draw=function(){var e=this.options;e.background&&this.drawBackground(),e.axis&&this.drawAxis(),e.header&&this.drawHeader()},z.prototype.redraw=function(e){this.elem.getContext("2d").clearRect(0,0,this.size[0],this.size[1]),this.options.data=e,this.draw()},z.prototype.drawBackground=function(){for(var e=this.options,t=this.ctx,r=this.size,i=e.background,n=[r[0]/2,r[1]/2],o=i.num?i.num:i.colors.length,a=p(n,e.paddingPercentage),s="circle"===i.type?"circle":"polygon",l=0;o>l;l++){var h=d(e,this,a*(o-l)/o),c=h.length;if(t.beginPath(),"polygon"===s){t.moveTo(h[0][0],h[0][1]);for(var f=0;c>f;f++){var u=f+1!=c?f+1:0;t.lineTo(h[u][0],h[u][1])}}else t.arc(n[0],n[1],a*(o-l)/o,0,2*Math.PI);t.closePath(),i.colors&&(t.fillStyle=i.colors[l%i.colors.length],t.fill()),i.border&&(t.strokeStyle=i.border.color?i.border.color:"transparent",t.lineWidth=i.border.width?parseInt(i.border.width):1,t.stroke())}},z.prototype.drawHeader=function(){for(var e=this.options,t=this.ctx,r=(this.size,this.centerPoint),i=e.header.offset?parseInt(e.header.offset)+p(r,e.paddingPercentage):p(r,e.paddingPercentage),o=this.dataLength,a=d(e,this,i),s="middle",l="center",h=n,c=0;o>c;c++){var f=a[c][0],u=a[c][1];f>r[0]-h&&r[0]+h>f?l="center":f>r[0]-h?l="left":r[0]+h>f&&(l="right"),u>r[1]-h&&r[1]+h>u?s="middle":u>r[1]-h?s="top":r[1]+h>u&&(s="bottom"),t.textBaseline=s,t.textAlign=l,t.font=e.header.font,t.fillStyle=e.header.color,t.fillText(e.categories[c],a[c][0],a[c][1])}},z.prototype.drawAxis=function(){for(var e=this.options,t=this.ctx,r=(this.size,this.centerPoint),i=this.dataLength,n=d(e,this,p(r,e.paddingPercentage)),o=e.axis,a=0;i>a;a++)t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(n[a][0],n[a][1]),t.strokeStyle=o.color,t.lineWidth=parseInt(o.width),t.stroke(),t.closePath()};var A=function(e){this.options=e,this.init()};A.prototype=new P,A.prototype.draw=function(){for(var t,r=this.options,i=this.frameNum,n=this.dataLength,o=r.series,a=o.length,s=r.legendEnableArr,l=this.size,p=this,c=[],f=[],g=[],v=0;a>v;v++)f.push(m(r,this,v)),g.push(d(r,this,f[v])),c.push(h(r,this,v));this.timer&&clearInterval(this.timer),u(o),this.timer=setInterval(function(){if(p.animationEnded=!1,i--,0>i)return r.preSeries=o,r.vertices=g,p.animationEnded=!0,clearInterval(p.timer),void 0;p.ctx.clearRect(0,0,l[0],l[1]);for(var e=0;a>e;e++)if(s[e]){t=[];for(var d=0;n>d;d++)g[e][d][0]+=c[e][d][0],g[e][d][1]+=c[e][d][1],t.push([g[e][d][0],g[e][d][1]]);p.drawByFrame(t,e)}},e)},A.prototype.drawByFrame=function(e,r){var i=this.ctx,n=this.dataLength,o=this.options.ploter;i.beginPath(),i.moveTo(e[0][0],e[0][1]);for(var a=0;n>a;a++){var s=a+1!=n?a+1:0;i.lineTo(e[s][0],e[s][1])}i.closePath(),i.strokeStyle=o.colors?o.colors[r]:"transparent",i.lineWidth=o.width?parseInt(o.width):2,i.globalAlpha=t[1],i.stroke(),i.fillStyle=i.strokeStyle,i.globalAlpha=t[0],i.fill(),this.options.marker&&this.drawMarkers(e,r)},A.prototype.drawMarkers=function(e,t){for(var r=e.length,i=0;r>i;i++)this.drawSingleMarker(e,t,i)},A.prototype.drawSingleMarker=function(e,r,i,n){var o=this.ctx,a=this.options.ploter,s=this.options.marker,n=n?n:1;o.beginPath(),o.arc(e[i][0],e[i][1],parseInt(s.radius)*n,0,2*Math.PI),o.closePath(),s.border&&(o.strokeStyle=s.border.color,o.lineWidth=2*parseInt(s.border.width)),o.globalAlpha=t[2],o.stroke(),o.fillStyle=a.colors?a.colors[r]:"transparent",o.fill()},A.prototype.redraw=function(e){this.options.series=e,this.draw()};var M=function(e,t){this.options=e,this.owner=t,this.init()};M.prototype={init:function(){var e=this.elem=a("div",{"class":"radarcharts-tooltip"},"cacac"),t=this.options,r=this.options.tooltip,i=this.owner,n=x(r)+"display: none; position: absolute; left: 0; top: 0; background: white; font-size: 12px; color: black; padding: 5px 10px; pointer-events: none";e.style.cssText=n,this.hide(),t.wrapper.appendChild(e),i.ploter.elem.onmousemove=function(e){i.ploter.animationEnded&&i.mousemoveHandler(e,t)}},show:function(e,t,r){this.render(t,r),this.elem.style.display="block",this.move(e[t][r])},hide:function(){this.owner.ploter.ctx.restore(),this.elem.style.display="none"},move:function(e){var t=this.elem;this.elem.style.left=e[0]-t.clientWidth/2+"px",this.elem.style.top=e[1]-t.clientHeight-10+"px"},render:function(e,t){elem=this.elem,elem.innerHTML=this.parseFormat(e,t),elem.style.borderColor=this.options.ploter.colors[e]},parseFormat:function(e,t){for(var r=this.options,i=r.tooltip.format,n=i.match(/\{(series|point)\.[a-zA-Z]+\}/g),o=n?n.length:0,a=/[{\.}]/,s={series:r.series[e],point:{name:r.categories[t],value:r.series[e].data[t]}},l=0;o>l;l++){var d=n[l],h=(" "+d).split(a),p=s[h[1]],c=h[2],f=p[c];i=i.replace(d,f)}return i}};var C=function(e){this.options=l(e||{},o),L(e),this.init()};C.prototype={init:function(){var e=this.options;this.setChartSize(e,e.renderTo.clientWidth),e.title&&this.setTitle(),this.setWrapper(e),this.setContainer(e),this.setDefaultLegendEnableArr(),this.background=new z(e),this.ploter=new A(e),this.setPloter(),e.tooltip&&(this.tooltip=new M(e,this)),e.legend&&this.setLegend(e)},setChartSize:function(e,t){if(!e.size)return e.size=[t,t],void 0;var r=g(e.size[0],t),i=g(e.size[1],t);e.size=[r,i]},setContainer:function(e){e.renderTo.appendChild(e.wrapper),e.renderTo.style.cssText=x(e.style),e.renderTo.style.width=e.size[0]+"px"},setWrapper:function(e){e.wrapper=a("div",{"class":"radarcharts-wrapper"}),e.wrapper.style.position="relative"},setPloter:function(){this.ploter.elem.style.position="absolute",this.ploter.elem.style.top=0,this.ploter.elem.style.left=0},redraw:function(e,t){t&&t.refresh&&(this.ploter.options.preSeries=void 0),this.ploter.redraw(e),this.renderLegend(this.options)},setTitle:function(){var e=a("p",{"class":"radarcharts-title"}),t=this.options.title,r=x(t);e.innerHTML=t.text,e.style.cssText=r,this.options.renderTo.appendChild(e)},setDefaultLegendEnableArr:function(){for(var e=this.options.series.length,t=[],r=0;e>r;r++)t.push(!0);this.options.legendEnableArr=t},mousemoveHandler:function(e,t){var t=this.options,r=(t.size,this.ploter),i=t.series.length,n=r.dataLength,o=r.options.vertices,a=e.target,s=b(a),l=[e.pageX-s[0],e.pageY-s[1]];if(t.currentMarker){if(T(t.currentMarker,l,t))return;t.currentMarker=null,this.tooltip.hide()}e:for(var d=0;i>d;d++)if(t.legendEnableArr[d])for(var h=0;n>h;h++)if(T(o[d][h],l,t)){this.tooltip.show(o,d,h),t.currentMarker=o[d][h];break e}},setLegend:function(e){var t=this.legendWrapper=a("div"),r=e.legend,i=x(r)+"text-align: center; font-size: 12px;";this.renderLegend(e),this.addEventForLegend(t),t.style.cssText=i,this.options.renderTo.appendChild(t)},renderLegend:function(e){if(e.legend){var t,r,i,n=e.ploter,o=e.series,s=o.length,l=e.legendEnableArr,d=this.legendWrapper,h="display: inline-block; cursor: pointer; margin: 2px 5px;",p=legendLineCssText="float: left; height: 16px; line-height: 16px;";d.innerHTML="";for(var c=0;s>c;c++)t=a("div",{"class":"radarcharts-legend"}),r=a("span"),i=a("span"),r.innerHTML=o[c].name,r.style.cssText=p,i.style.cssText=legendLineCssText+"margin-right: 2px; height: 8px; width: 30px; border-bottom: 2px solid"+(n?n.colors[c]:"transparent")+";",t.style.cssText=h,t.appendChild(i),t.appendChild(r),d.appendChild(t),l[c]||this.disableLegend(t)}},addEventForLegend:function(e){var t=this;e.onclick=function(e){var r=e.target,n=this.childNodes,o=s(t.options.series),a=t.options.legendEnableArr;if(y(r.parentNode,"radarcharts-legend")&&(r=r.parentNode),y(r,"radarcharts-legend"))for(i=0;n.length>i;i++)n[i]==r&&(y(r,"disabled")?(t.enableLegend(r),a[i]=!0):(t.disableLegend(r),a[i]=!1),t.ploter.redraw(o))}},disableLegend:function(e){w(e,"disabled"),e.style.opacity=t[0]},enableLegend:function(e){k(e,"disabled"),e.style.opacity=t[2]},destroy:function(){this.ploter.elem.onmousemove=null,this.legendWrapper.onclick=null,this.options.renderTo.innerHTML=""}},window.Radarcharts=C,window.jQuery&&($.fn.Radarcharts=function(e){return e.renderTo=this[0],new Radarcharts(e)})})();